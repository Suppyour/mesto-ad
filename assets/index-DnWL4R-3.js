(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const R=e=>{e.remove()},A=(e,t,{onPreviewPicture:o,onLikeIcon:n,onDeleteCard:r})=>{const s=document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),c=s.querySelector(".card__like-button");s.querySelector(".card__like-button_is-active");const u=s.querySelector(".card__control-button_type_delete"),S=s.querySelector(".card__image"),w=s.querySelector(".card__like-count");return S.src=e.link,S.alt=e.name,s.querySelector(".card__title").textContent=e.name,w.textContent=e.likes.length,e.likes.some(J=>J._id===t)&&c.classList.add("card__like-button_is-active"),n&&c.addEventListener("click",()=>{n(c,w,e._id)}),e.owner._id!==t?u.remove():r&&u.addEventListener("click",()=>{r(e._id,s)}),o&&S.addEventListener("click",()=>o({name:e.name,link:e.link})),s},M=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",M)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",M)},z=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&p(e)})},K=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},$=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},G=(e,t,o)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?$(e,t,o):K(e,t,t.validationMessage,o)},Q=e=>e.some(t=>!t.validity.valid),F=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},X=(e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)},B=(e,t,o)=>{Q(e)?F(t,o):X(t,o)},Y=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);B(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{G(e,r,t),B(o,n,t)})})},Z=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{Y(o,e)})},C=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{$(e,r,t),r.setCustomValidity("")}),F(n,t)},a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"29ae178e-d4e8-485a-9112-44008e04f970","Content-Type":"application/json"}},i=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ee=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(i),O=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(i),te=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(i),oe=e=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(i),re=({name:e,link:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(i),ne=e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(i),se=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(i),v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},T=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),f=L.querySelector(".popup__form"),N=f.querySelector(".popup__input_type_name"),D=f.querySelector(".popup__input_type_description"),g=document.querySelector(".popup_type_new-card"),d=g.querySelector(".popup__form"),ce=d.querySelector(".popup__input_type_card-name"),ae=d.querySelector(".popup__input_type_url"),q=document.querySelector(".popup_type_image"),P=q.querySelector(".popup__image"),le=q.querySelector(".popup__caption"),ie=document.querySelector(".profile__edit-button"),ue=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),I=document.querySelector(".popup_type_edit-avatar"),_=I.querySelector(".popup__form"),pe=_.querySelector(".popup__input");let b=null;const h=(e,t)=>{t.textContent=e?"Сохранение...":"Сохранить"},W=({name:e,link:t})=>{P.src=t,P.alt=e,le.textContent=e,y(q)},V=(e,t,o)=>{const n=e.classList.contains("card__like-button_is-active");se(o,n).then(r=>{e.classList.toggle("card__like-button_is-active"),t.textContent=r.likes.length}).catch(r=>console.log(r))},j=(e,t)=>{ne(e).then(()=>{R(t)}).catch(o=>console.log(o))},de=e=>{e.preventDefault();const t=f.querySelector(".popup__button");h(!0,t),te({name:N.value,about:D.value}).then(o=>{k.textContent=o.name,E.textContent=o.about,p(L)}).catch(o=>{console.log(o)}).finally(()=>{h(!1,t)})},me=e=>{e.preventDefault();const t=_.querySelector(".popup__button");h(!0,t),oe(pe.value).then(o=>{x.style.backgroundImage=`url(${o.avatar})`,p(I)}).catch(o=>{console.log(o)}).finally(()=>{h(!1,t)})},_e=e=>{e.preventDefault();const t=d.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",re({name:ce.value,link:ae.value}).then(n=>{T.prepend(A(n,b,{onPreviewPicture:W,onLikeIcon:V,onDeleteCard:j})),p(g)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})};f.addEventListener("submit",de);d.addEventListener("submit",_e);_.addEventListener("submit",me);ie.addEventListener("click",()=>{N.value=k.textContent,D.value=E.textContent,C(f,v),y(L)});x.addEventListener("click",()=>{_.reset(),C(_,v),y(I)});ue.addEventListener("click",()=>{d.reset(),C(d,v),y(g)});const ye=document.querySelectorAll(".popup");ye.forEach(e=>{z(e)});Z(v);Promise.all([ee(),O()]).then(([e,t])=>{b=e._id,k.textContent=e.name,E.textContent=e.about,x.style.backgroundImage=`url(${e.avatar})`,t.forEach(o=>{T.append(A(o,b,{onPreviewPicture:W,onLikeIcon:V,onDeleteCard:j}))})}).catch(e=>{console.log(e)});const H=document.querySelector(".popup_type_info"),l=H.querySelector(".popup__info-list"),fe=document.querySelector(".logo"),U=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),m=(e,t)=>{const o=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return o.querySelector(".popup__definition-term").textContent=e,o.querySelector(".popup__definition-description").textContent=t,o},he=e=>{const t=document.getElementById("popup-info-user-preview-template").content.cloneNode(!0);return t.querySelector(".popup__user-preview").textContent=e,t},ve=()=>{O().then(e=>{l.innerHTML="",l.append(m("Всего карточек:",e.length)),e.length>0&&(l.append(m("Первая создана:",U(new Date(e[e.length-1].createdAt)))),l.append(m("Последняя создана:",U(new Date(e[0].createdAt)))));const t={};e.forEach(c=>{const u=c.owner.name;t[u]||(t[u]=0),t[u]++});const o=Object.keys(t).length;l.append(m("Всего пользователей:",o));let n=0;for(const c in t)t[c]>n&&(n=t[c]);l.append(m("Максимум карточек от одного:",n));const r=document.createElement("h3");r.textContent="Все пользователи:",r.style.marginTop="20px",l.append(r);const s=document.createElement("div");s.style.display="flex",s.style.flexWrap="wrap",s.style.gap="10px",Object.keys(t).forEach(c=>{s.append(he(c))}),l.append(s),y(H)}).catch(e=>{console.log(e)})};fe.addEventListener("click",ve);
